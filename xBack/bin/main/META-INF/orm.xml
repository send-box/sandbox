<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings>xmlns="http://xmlns.jcp.org/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
    http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
    version="2.1">

    <!-- find last so2_value by sidoname and mangname at each station -->
    <named-native-query name="measureInfoRealEntity.findSO2ValueInfoRealBySidonameAndMangname">
        <query><![CDATA[
			SELECT
				m.data_time as datatime,
				m.sido_name as sidoname,
				m.station_name as stationname,
				m.mang_name as mangname,
				m.so2_value as so2value
			FROM (
				SELECT 
					data_time,
					sido_name,
					station_name,
					mang_name,
					so2_value,
					row_number() over (partition by sido_name, station_name, mang_name order by data_time desc) rn
				FROM public.measure_info_real
				WHERE 
					sido_name = ?1 and 
					mang_name = ?2 and
					1 = 1
			) m
			WHERE 
				m.rn = 1 and
				1 = 1;
         ]]></query>
    </named-native-query>

</entity-mappings>